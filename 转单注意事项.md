### 转单注意事项



**参与销转采的直发业务的销售订单，仓库需要是虚拟仓属性的仓库**

转单以后的仓库必须是带有虚拟仓库属性的仓库（直发仓的定义）



**直发业务-退货业务的仓库选择必须是非虚拟属性的仓（非直发仓）**

销售退货时的仓库，如果原是备货仓发货，退回时默认选择备货仓，但可修改；

如果原是虚拟直发仓发货，退回时需重新选择备货仓；如果实际不是退回三方仓，另行建立一个仓；



**虚拟直发仓库存始终为零**

直发业务是做一进一出，退货不退到虚拟仓，所以直发仓的库存始终为0；



**采购订单手工制单，标记为直发业务与客户端发货地址，需确认关联销售订单** 

采购订单非转单生成，若修改标记为直发业务，**提交**时需确认是否有关联销售订单；（目前采用这种方式）

若此时销售订单未生成，则需及时补销售订单，并与采购订单关联，确保供应商直发后能同时进行虚拟直发仓的出入库与订单核销。



**销售订单转采购订单回写数据**

①销售订单应记录已转数量，记录对应的转单状态。

转到采购订单后，无论采购订单是否有异常，回写已转数量，计算可转数量；

转单生成的采购订单因删除操作，再次回写已转数量，计算可转数量；

销售订单转单状态：部分转单、全部转单、未转单、部分转单入库、  全部转单入库



**订单辅助数量说明**

发货数量=发货通知单回写数量；不大于订单数量；

转单数量=销转采，采购订单回写数量；

可转数量=订单数量-发货数量-取消数量-转单数量；

销售订单数量>= 转单数量+发货数量+取消数量；（可用于订单异常数据统计）



**转单状态与转单数量对应**

| 转单状态 | 状态计算公式                             | 订单数量 | （已）转单数量 | 发货数量 | *可转数量* | 取消数量 |
| -------- | ---------------------------------------- | -------- | -------------- | -------- | ---------- | -------- |
| 未转单   | 转单数量为0，采购订单取消后需要重置为0； | 10       | 0              | 0        | 10         | 0        |
| 全部转单 | 订单数量范围内：转单数量>0，可转数量=0； | 10       | 10             | 0        | 0          | 0        |
| 部分转单 | 转单数量不为空且大于0，且可转数量>0；    | 10       | 5              | 3        | 2          | 0        |
| 部分转单 | 转单数量不为空且大于0，且可转数量>0；    | 10       | 2              | 5        | 2          | 1        |
|          |                                          |          |                |          |            |          |



**先转单后发货之——可发货判断**

①当一笔销售业务未备货仓发货，当库存不足，未完成发货的销售订单转采购订单，采购订单并选择直发业务模式，订单未发货数量全部转成转单数量，订单不可继续发货。需要等待直运采购订单入库后，【*可发货数量>0*】方可执行发货。

②当一笔销售业务未备货仓发货，当库存不足，未完成发货的销售订单转采购订单，采购直发数量（采购订单数量）不超过关联销售待发货数

***示例订单&发货&转单状态过程说明***

| 序号 | 订单状态     | 状态计算公式                           | 订单数量 | （已）转单数量 | 发货数量 | *可转数量* | 取消数量 | 转单入库数量 | *可发货数量* |
| ---- | ------------ | -------------------------------------- | -------- | -------------- | -------- | ---------- | -------- | ------------ | ------------ |
| 1    | 部分发货     | 发货数量大于0小于（订单数量-取消数量） | 10       | 0              | 5        | 0          | 1        | 0            | 4            |
| 2    | 部分转单     | 可转数量>0；转单数量>0                 | 10       | 4              | 5        | 0          | 1        | 0            | 0            |
| 3    | 转单部分入库 | 转单入库数量>0且<转单数量              | 10       | 4              | 5        | 0          | 1        | 2            | 2            |
| 4    | 转单全部入库 | 转单数量=转单入库数量                  | 10       | 4              | 5        | 0          | 1        | 4            | 4            |



**订单状态类型**

单据状态、发货状态、出库状态、转单状态



| 订单状态类型                             | 状态值       | 状态值说明                                                   |
| ---------------------------------------- | ------------ | ------------------------------------------------------------ |
| 订单状态                                 | 草稿/暂存    | 新建暂存                                                     |
|                                          | 待审核       | 提交待审核，审核人员未审核                                   |
|                                          | 审核通过     | 审核通过，审核流程执行完毕                                   |
|                                          | 审核失败     | 审核失败                                                     |
|                                          | 已取消       | 订单整单取消                                                 |
|                                          | 已完成       | 出库完成                                                     |
|                                          | 发货未出库   | 发货通知单下推仓库未出库，即发货数量>出库数量                |
|                                          | 异常待确认   | 拉取协同订单出现异常，且商务人员没有确认                     |
| 以下全是审核通过的基础上操作的产生的状态 |              |                                                              |
| 发货状态                                 | 待发货       | 发货数量=0                                                   |
|                                          | 部分发货     | 订单数量-取消数量>发货数量                                   |
|                                          | 全部发货     | 订单数量=发货数量                                            |
| 出库状态                                 | 待出库       | 出库数量=0                                                   |
|                                          | 部分出库     | 订单数量-取消数量>出库数量；即包含【发货未出库】、【部分发货】 |
|                                          | 全部出库     | 出库数量等于订单数量-订单取消数量；即订单全部发货且全部发货  |
| 转单状态                                 | 未转单       | 转单数量=0                                                   |
|                                          | 部分转单     | 订单数量范围内：可转数量>0；转单数量>0                       |
|                                          | 全部转单     | 订单数量范围内：可转数量=0；转单数量>0                       |
|                                          | 部分转单入库 | 订单数量范围内：可转数量>0；转单数量>0；入库数量= 转单数量   |
|                                          | 全部转单入库 | 订单数量范围内：可转数量=0；转单数量>0；入库数量= 转单数量   |
|                                          | 转单未入库   | 订单数量范围内：转单数量>0，转单入库数量=0；                 |